
@{
    ViewBag.Title = "Role_authorization";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}

<form class="layui-form">
    <div id="" class=""><ul id="checkbarTree2" class="dtree" data-id="0"></ul></div>
</form>
<div class="layui-row" style="margin-top:30px;">
    <div class="layui-col-xs2">&nbsp;</div>
    <div class="layui-col-xs5">
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn layui-btn-fluid" id="Sava"> 保存</button>
            </div>
        </div>
    </div>
</div>
<input type="hidden" id="authorizationStr" />
@section scripts{
    <link href="~/lib/dtree/dtree/font/dtreefont.css" rel="stylesheet" />
    <link href="~/lib/dtree/dtree/dtree.css" rel="stylesheet" />
    <script type="text/javascript">
        var Id = GetQueryString("Id");
        layui.extend({
            dtree: '/lib/dtree/dtree/dtree'
        }).use(['dtree'], function () {

            var data = [
                {
                    "id": "001",
                    "title": "湖南省",
                    "parentId": "0",
                    "checkArr": [
                        {
                          
                            "checked": "0"
                        }
                    ],
                    "children": [
                        {
                            "id": "001001",
                            "title": "长沙市",
                            "parentId": "001",
                            "checkArr": [
                                {
                                  
                                    "checked": "0"
                                }
                            ]
                        },
                        {
                            "id": "001002",
                            "title": "株洲市",
                            "parentId": "001",
                            "checkArr": [
                                {
                                  
                                    "checked": "0"
                                }
                            ]
                        },
                        {
                            "id": "001003",
                            "title": "湘潭市",
                            "parentId": "001",
                            "checkArr": [
                                {
                                  
                                    "checked": "0"
                                }
                            ]
                        },
                        {
                            "id": "001004",
                            "title": "衡阳市",
                            "parentId": "001",
                            "checkArr": [
                                {
                                  
                                    "checked": "0"
                                }
                            ]
                        },
                        {
                            "id": "001005",
                            "title": "郴州市",
                            "parentId": "001",
                            "checkArr": [
                                {
                                  
                                    "checked": "0"
                                }
                            ]
                        }
                    ]
                },
                {
                    "id": "002",
                    "title": "湖北省",
                    "parentId": "0",
                    "checkArr": [
                        {
                          
                            "checked": "0"
                        }
                    ],
                    "children": [
                        {
                            "id": "002001",
                            "title": "武汉市",
                            "checkArr": [
                                {
                                  
                                    "checked": "0"
                                }
                            ]
                        },
                        {
                            "id": "002002",
                            "title": "黄冈市",
                            "checkArr": [
                                {
                                  
                                    "checked": "0"
                                }
                            ],
                            "parentId": "002"
                        },
                        {
                            "id": "002003",
                            "title": "潜江市",
                            "parentId": "002",
                            "checkArr": [
                                {
                                  
                                    "checked": "0"
                                }
                            ]
                        },
                        {
                            "id": "002004",
                            "title": "荆州市",
                            "parentId": "002",
                            "checkArr": [
                                {
                                  
                                    "checked": "0"
                                }
                            ]
                        },
                        {
                            "id": "002005",
                            "title": "襄阳市",
                            "parentId": "002",
                            "checkArr": [
                                {
                                  
                                    "checked": "0"
                                }
                            ]
                        }
                    ]
                },
                {
                    "id": "003",
                    "title": "广东省",
                    "parentId": "0",
                    "checkArr": [
                        {
                          
                            "checked": "0"
                        }
                    ],
                    "children": [
                        {
                            "id": "003001",
                            "title": "广州市",
                            "parentId": "003",
                            "checkArr": [
                                {
                                  
                                    "checked": "0"
                                }
                            ],
                            "children": [
                                {
                                    "id": "003001001",
                                    "title": "天河区",
                                    "parentId": "003001",
                                    "checkArr": [
                                        {
                                          
                                            "checked": "0"
                                        }
                                    ]
                                },
                                {
                                    "id": "003001002",
                                    "title": "花都区",
                                    "parentId": "003001",
                                    "checkArr": [
                                        {
                                          
                                            "checked": "0"
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "id": "003002",
                            "title": "深圳市",
                            "parentId": "003",
                            "checkArr": [
                                {
                                    "checked": "1"
                                }
                            ]
                        },
                        {
                            "id": "003003",
                            "title": "中山市",
                            "parentId": "003",
                            "checkArr": [
                                {
                                  
                                    "checked": "0"
                                }
                            ]
                        },
                        {
                            "id": "003004",
                            "title": "东莞市",
                            "parentId": "003",
                            "checkArr": [
                                {
                                  
                                    "checked": "0"
                                }
                            ]
                        },
                        {
                            "id": "003005",
                            "title": "珠海市",
                            "parentId": "003",
                            "checkArr": [
                                {
                                  
                                    "checked": "0"
                                }
                            ]
                        },
                        {
                            "id": "003006",
                            "title": "韶关市",
                            "parentId": "003",
                            "checkArr": [
                                {
                                  
                                    "checked": "0"
                                }
                            ]
                        }
                    ]
                },
                {
                    "id": "004",
                    "title": "浙江省",
                    "parentId": "0",
                    "checkArr": [
                        {
                          
                            "checked": "0"
                        }
                    ],
                    "children": [
                        {
                            "id": "004001",
                            "title": "杭州市",
                            "parentId": "004",
                            "checkArr": [
                                {
                                  
                                    "checked": "0"
                                }
                            ]
                        },
                        {
                            "id": "004002",
                            "title": "温州市",
                            "parentId": "004",
                            "checkArr": [
                                {
                                  
                                    "checked": "0"
                                }
                            ]
                        },
                        {
                            "id": "004003",
                            "title": "绍兴市",
                            "parentId": "004",
                            "checkArr": [
                                {
                                  
                                    "checked": "0"
                                }
                            ]
                        },
                        {
                            "id": "004004",
                            "title": "金华市",
                            "parentId": "004",
                            "checkArr": [
                                {
                                  
                                    "checked": "0"
                                }
                            ]
                        },
                        {
                            "id": "004005",
                            "title": "义乌市",
                            "parentId": "004",
                            "checkArr": [
                                {
                                  
                                    "checked": "0"
                                }
                            ]
                        }
                    ]
                },
                {
                    "id": "005",
                    "title": "福建省",
                    "parentId": "0",
                    "checkArr": [
                        {
                          
                            "checked": "0"
                        }
                    ],
                    "children": [
                        {
                            "id": "005001",
                            "title": "厦门市",
                            "parentId": "005",
                            "checkArr": [
                                {
                                  
                                    "checked": "0"
                                }
                            ]
                        }
                    ]
                }
            ];
            var element = layui.element,
                layer = layui.layer,
                form = layui.form,
                dtree = layui.dtree,
                $ = layui.$;
            dtree.render({
                elem: "#checkbarTree2",
                url: '/Home/GetRole_authorization',
              
                checkbar: true
            });

            dtree.on("chooseDone('checkbarTree2')", function (obj) {
             //   layer.msg(JSON.stringify(obj.checkbarParams)); // 选中的所有复选框的参数
                $("#authorizationStr").val(JSON.stringify(obj.checkbarParams));
            });
            });
        $(function () {
           
            $("#Sava").click(function () {
                var authorizationStr = "";
                var authorization = eval($("#authorizationStr").val());
                for (var i = 0; i < authorization.length; i++) {
                    authorizationStr += authorization[i].nodeId + ",";
                }
                $.ajax({
                    type: "POST",
                    url: "/Home/Role_authorization",
                    data: { RoleId: Id, authorizationStr: authorizationStr.substring(0, authorizationStr.length - 1) },
                    success: function (resInfo) {
                        if (resInfo.res) {
                            Mmsg("分配成功！");
                            window.parent.layer.closeAll();//关闭弹窗
                        } else {
                            Mmsg("分配失败:" + resInfo.info + " !");
                        }
                    },
                    error: function (jqXHR) {
                        Mmsg("系统繁忙 !");
                        console.log("Error: " + jqXHR.status);
                    }
                });

            });

   
        })
    </script>
}
